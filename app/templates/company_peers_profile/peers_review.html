{% extends "base.html" %}
{% import 'bootstrap/wtf.html' as wtf %}

{% block app_content %}
    <h1>Обзор конкурентов</h1>
    <p><i>{{ descr }}</i></p>
    <p>
        Данные доступны за период с <b>{{ moment(g.min_report_date).format('LL') }}</b> 
        по <b>{{ moment(g.last_report_date).format('LL') }}</b>
    </p>    
    <div class="row">
        <div class="col-md-4">
            {{ wtf.quick_form(form) }}
        </div>
    </div>

    {% if show_balance %}
        <h1>Компания: {{ company_name }}</h1>
        <h3>Выбранные конкуренты: {{ peers_names }}</h3>
        <div align="center">
            <h2>Основные балансовые показатели</h2>
            <p><b>на {{ moment(e).format('LL') }}</b></p>
            <p><i>* все показатели, кроме норматива маржи платежеспособности, приведены <b>в тыс.тг.</b></i></p>
            <div class="table-responsive">
                <table class="table table-hover">
                    <tr>
                        <th>Показатель</th>
                        <th align="right">{{ company_name }}</th>                        
                        <th align="right">Среднее по конкурентам</th>
                        {% if show_competitors %}
                            {% for c in peers_names_arr %}
                                <th align="right">{{ c.peer_name }}</th>
                            {% endfor %}
                        {% endif %}
                    </tr>
                    {% for ind in balance_indicators %}
                    <tr>
                        <td>{{ ind.fullname }}</td>
                        {% if ind.name == 'solvency_margin' %}<!--маржу покажем с 2 знаками после запятой-->
                            <td align="right">{{ "{:,.2f}".format(ind.value) }}</td>                            
                            <td align="right">{{ "{:,.2f}".format(ind.mkt_av) }}</td>                            
                        {% else %}<!--остальные показатели покажем с 0 знаками после запятой-->
                            <td align="right">{{ "{:,.0f}".format(ind.value) }}</td>                            
                            <td align="right">{{ "{:,.0f}".format(ind.mkt_av) }}</td>                            
                        {% endif %}
                        {% if show_competitors %}
                            {% for p in ind.peers_balance_ind %}
                                {% if ind.name == 'solvency_margin' %}
                                    <td align="right">{{ "{:,.2f}".format(p.peer_value) }}</td>
                                {% else %}
                                    <td align="right">{{ "{:,.0f}".format(p.peer_value) }}</td>
                                {% endif %}
                            {% endfor %}
                        {% endif %}
                    </tr>
                    {% endfor %}
                </table>
            </div>
        </div>
    {% endif %}

    {% if show_income_statement %}
        <div align="center">
            <h2>Основные показатели ОПУ</h2>
            <p><b>за период с {{ moment(b).format('LL') }} по {{ moment(e).format('LL') }}</b></p>
            <p><i>* все показатели приведены <b>в тыс.тг.</b></i></p>
            <div class="table-responsive">
                <table class="table table-hover">
                    <tr>
                        <th>Показатель</th>
                        <th align="right">{{ company_name }}</th>                        
                        <th align="right">Среднее по конкурентам</th>
                        {% if show_competitors %}
                            {% for c in peers_names_arr %}
                                <th align="right">{{ c.peer_name }}</th>
                            {% endfor %}
                        {% endif %}
                    </tr>
                    {% for ind in flow_indicators %}
                    <tr>
                        <td>{{ ind.fullname }}</td>
                        <td align="right">{{ "{:,.0f}".format(ind.value) }}</td>
                        <td align="right">{{ "{:,.0f}".format(ind.mkt_av) }}</td>
                        {% if show_competitors %}
                            {% for p in ind.peers_flow_ind %}
                                <td align="right">{{ "{:,.0f}".format(p.peer_value) }}</td>
                            {% endfor %}
                        {% endif %}
                    </tr>
                    {% endfor %}
                </table>
            </div>
        </div>
    {% endif %}

    {% if show_other_financial_indicators %}        
        <div align="center">
            <h2>Другие финансовые показатели</h2>
            <p><b>за период с {{ moment(b).format('LL') }} по {{ moment(e).format('LL') }}</b></p>
            <div class="table-responsive">
                <table class="table table-hover">
                    <tr>
                        <th>Показатель</th>
                        <th align="right">{{ company_name }}</th>
                        <th align="right">Среднее по конкурентам</th>
                        {% if show_competitors %}
                            {% for c in peers_names_arr %}
                                <th align="right">{{ c.peer_name }}</th>
                            {% endfor %}
                        {% endif %}
                    </tr>
                    {% for ind in other_financial_indicators %}
                        <tr>
                            <td>{{ ind.name }}</td>
                            <td>{{ ind.value_c }}</td>
                            <td>{{ ind.value_m }}</td>
                            {% if show_competitors %}
                                {% for p in ind.peers_other_fin_ind %}
                                    <td align="right">{{ p.peer_value }}</td>
                                {% endfor %}
                            {% endif %}
                        </tr>
                    {% endfor %}
                </table>
            </div>
    {% endif %}

{% endblock %}